参考资料---《图解HTTP协议》

### 一、了解Web及网络基础

在开始之前，我们需要了解一个概念-**协议**，我的理解是通信双方要遵守的约定。例如，我们规定了Web页面要使用html语言来写,例如规定了双方通信时如何探测目标，例如硬件(路由器、计算机)在接入互联网时应该选择什么样的光缆。

#### 使用HttP协议访问web

目的是为了访问某个服务器上的资源而诞生出一种协议。

#### HTTP的诞生

方便知识共享的万维网(world wide web)

http0.9->http1.0->http->1.1

#### 网络基础TCP/IP-重点

#####　TCP/IP协议族

这里所讲的是TCP/IP协议族，协议族中包含大量的协议，其中较为重要的是TCP协议和IP协议，协议中存在着各式各样的内容，电缆的规格、IP地址的选定方法、寻找异地用户的方法、双方建立通信的顺序以及Web页面的加载顺序等等。

##### TCP/IP的分层管理

通过各种协议的作用结合计算机网络，我们将协议进行分层。

###### 应用层

决定了向用户提供**应用服务通信**时的活动，l例如使用浏览器访问某个页面，不难想到，HTTP协议就位于这一层。

TCP/IP协议族中预存了各类通信时的服务。例如，FTP(FIle Transfer Protocol,文件传输协议)和DNS(Domain Name System);

###### 传输层

传输层对上层应用层，体统处于网络连接中的**两台计算机之间的数据传输**。例如，访问B站时 ，个人计算机和B站服务器(计算机)之间的数据传输。

有两个性质不同的协议：**TCP(Transmissiion Control Protocool,传输控制协议)和UDP(User Data Protocol,用户控制协议)**:

###### 网络层

网络层用来**处理网络上流动的数据包**。数据包是网络传输的最小数据单位。该层规定了通过**怎样的路径(传输路径)到达对方的计算机，并把数据包传送给对方**。

###### 链路层

用来处理网络的硬件部分。包括操作系统、硬件的设备驱动、NIC(Network InterFace Card,网络适配器)，及光钎等物理可见部分。

##### TCP/IP的通信传输流

我们来梳理一下网络通信时的协议族中的各个协议在各层发挥的作用。

![](https://gitee.com/aryangzhu/picture/raw/master/TCP-IP%E4%BC%A0%E8%BE%93%E6%B5%81.png)

发送端从应用层往下走，接收端则是从下往上走。

书中的例子是HTTP,首先作为发送端的**客户端在应用层发送一个(HTTP协议)发送一个想看某个Web页面的HTTP请求**。

然后，在传输层(TCP协议)将HTTP请求分成**一个个数据包**，再在各个数据上打上**标记序号和发送IP地址**。

到了网络层(IP协议)，将在各个数据包加上**MAC(地址每台硬件独一无二的标识)**。

接收端的服务器在**链路层接收到数据包**，再传给上层。

发送端每经过一层将会加上一个**协议首部**，在接收端会逐层解析后去掉。

#### 与HTTP关系密切的协议：IP、TCP&DNS

##### 负责传输的IP协议

IP协议的作用是将数据包传输到正确的地址，而要完成这一目标则需要满足许多条件。比较重要的两个条件是**MAC地址和IP地址,这两个地址可以搭配使用**

IP地址指明了**节点被分配的地址，是可以改变的**。

MAC地址网卡的**固有地址，是唯一的**。

很少有情况是在局域网内部的两台计算机进行数据传输，通常要通过多台计算机或者网络设备来作为**中转站**。这时我们需要得知下一站的MAC地址来确定下一个跳转的中转站。**ARP(Address Resolution Protocol)协议的作用是，通过通信方的IP地址来确定它的MAC地址。**

**在通信过程中无法无法全面掌控传输过程**

**路由选择机制**，就像寄一个快递包裹，你只需将快递拿到集散中心，集散中心会知道是否肯发货(做出某种判断)，再将货物送给下一个集散中心，下个区域的集散中心再确定能否送到对方家中。

##### 负责确保可靠性的TCP协议

TCP处于传输层，提供可靠的字节流服务。字节流服务是将大的数据块分成以数据报文为单位的数据包。而且TCP协议能够确认对方是否收到了数据包。

###### 三次握手策略

![](https://gitee.com/aryangzhu/picture/raw/master/%E4%B8%89%E6%AC%A1%E6%8F%A1%E6%89%8B.png)

发送端首先会**发送一个带有SYN(synchronized)标识**的数据包，接收端在接收到以后会回传一个**带有SYN/ACK(acknowlege)的标识**传达确认可以接收的信息，然后发送端再发送一个**带有ACK标识**的数据包。至此，"握手"完成。

#### 负责域名解析的DNS服务

和HTTP协议一样存在于应用层，功能是**将主机域名解析为IP地址**。例如，想要访问某个网页(www.bilibili.com)，DNS服务会将这个域名转换为IP地址(形如192.168.1.1)。

#### 各种协议与HTTP协议的关系

通过下面能够直观地看出IP协议、TCP协议和DNS服务在**使用HTTP协议通信的过程**发挥的作用。

![](https://gitee.com/aryangzhu/picture/raw/master/%E4%BD%BF%E7%94%A8http%E5%AE%8C%E6%95%B4%E9%80%9A%E4%BF%A1%E8%BF%87%E7%A8%8B.png)

#### URI和URL

URI-统一资源标识符

URL-统一资源定位符

URI用字符串表示某一组互联网的资源，而URL表示资源所在位置。

###### 绝对URI

https://gitee.com/aryangzhu/picture/raw/master/%E7%BB%9D%E5%AF%B9URI.png

**服务器地址**

使用绝对URI必须得有服务器地址，可以是可解析的域名，也可以是IPV4或者IPV6地址。

**带层次的文件地址**

类似于UNIX系统的文件路径。指定服务器上的某个特指资源。

**查询字符串**

针对已指定的文件路径内的资源，进行字符串匹配。

**片段标识符**

取出已获取资源的子资源。

###### 绝对URL

###### 相对URL

形如/iamge/logo.gif

### 二、简单的HTTP协议

#### HTTP用于客户端和服务端之间的通信

#### 通过请求和响应的交换达成通信

HTTP协议要求必须得有一个客户端和一个服务端，并且客户端发送请求由服务端进行响应。

请求报文结构

GET /index.html HTTP/1.1

Host:hackr.jp

Contnection:keep-alive;



name=zhangsan&age=37

**请求方法、请求URI、HTTP协议版本号、报文首部字段、内容实体**

响应报文结构

HTTTP/1.1 200 OK

Date: True, 10.....

\<html>....

**协议版本、状态码、原因短语、首部字、主体**

#### HTTP不保存状态

第二次通信时，双方无法得知之前的通信内容是什么。

#### 请求URI定位资源

#### 告知服务器意图的HTTP方法

#### 使用方法下达命令

**GET-获取某个资源**

**POST-传输实体主体(例如想要得知服务器上某个程序执行的结果)**

**PUT-客户端发送/上传文件**

**HEAD-获得报文首部(例如服务器上某个文件的创建时间等等相关信息，不需要返回主体)**

**DELETE-删除文件**

OPTIONS-询问支持的方法

TRACE-追踪路径

Connect-要求建立隧道协议连接代理(SSL-安全套接层)

#### 持久连接节省通信量

一开始，每一次请求之前都需要先建立TCP连接，HTTP响应之后也需要断开TCP连接。

###### 持久连接

只在第一次发送HTTP请求时建立TCP连接，最后一次HTTP响应时断开连接。

###### 管线化

原来情况是第一个请求被响应之后才能继续发送请求，管线化是指第一个请求发送之后，可以继续发送第二个请求。并行化发送请求大大提高了效率。

#### 使用Cookie的状态管理

从例子开始，某些网页我们需要进行身份验证。而HTTP协议是无状态的，也就是说服务器不知道客户端圆脸已经验证过身份，想想看，B站如果打开宅舞区需要验证身份，打开鬼畜区还得验证身份，那么用户还不得麻烦死。

Cookie是在客户端发送请求到服务端之后，服务端在响应报文首部字段中添加一个Set-Cookie。客户端在后面发送请求时，就会请求报文首部字段中携带上Cookie值。服务端接收请求之后回合服务器上的值进行比较，从而确认是那个客户端发送的请求。

