<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta http-equiv="X-UA-Compatible" content="ie=edge">
<title>Markmap</title>
<style>
* {
  margin: 0;
  padding: 0;
}
#mindmap {
  display: block;
  width: 100vw;
  height: 100vh;
}
</style>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/prismjs@1.28.0/themes/prism.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/markmap-toolbar@0.14.3/dist/style.css">
</head>
<body>
<svg id="mindmap"></svg>
<script src="https://cdn.jsdelivr.net/npm/d3@6.7.0"></script><script src="https://cdn.jsdelivr.net/npm/markmap-view@0.14.3"></script><script src="https://cdn.jsdelivr.net/npm/markmap-toolbar@0.14.3/dist/index.umd.min.js"></script><script>(r => {
                setTimeout(r);
              })(() => {
  const {
    markmap,
    mm
  } = window;
  const toolbar = new markmap.Toolbar();
  toolbar.attach(mm);
  const el = toolbar.render();
  el.setAttribute('style', 'position:absolute;bottom:20px;right:20px');
  document.body.append(el);
})</script><script>((getMarkmap, getOptions, root, jsonOptions) => {
        const markmap = getMarkmap();
        window.mm = markmap.Markmap.create('svg#mindmap', (getOptions || markmap.deriveOptions)(jsonOptions), root);
      })(() => window.markmap,null,{"type":"root","depth":0,"content":"","children":[{"type":"paragraph","depth":1,"payload":{"lines":[1,8]},"content":"html:<br>\ntoc: true<br>\n# number_sections: true<br>\ntoc_depth: 6<br>\ntoc_float: true<br>\ncollapsed: true<br>\nsmooth_scroll: true"},{"type":"heading","depth":1,"payload":{"lines":[9,10]},"content":"重新认识MySQL","children":[{"type":"heading","depth":2,"payload":{"lines":[10,11]},"content":"客户端/服务器架构"},{"type":"heading","depth":2,"payload":{"lines":[11,12]},"content":"MySQL的安装","children":[{"type":"heading","depth":3,"payload":{"lines":[12,13]},"content":"bin目录下的可执行文件"}]},{"type":"heading","depth":2,"payload":{"lines":[14,15]},"content":"启动MySQL服务器程序","children":[{"type":"heading","depth":3,"payload":{"lines":[15,16]},"content":"UNIX里启动服务器程序","children":[{"type":"list_item","depth":4,"payload":{"lines":[16,17],"index":1},"content":"1. mysqld 可以启动一个服务器进程"},{"type":"list_item","depth":4,"payload":{"lines":[17,18],"index":2},"content":"2. mysqld_safe  启动脚本,间接调用mysqld,顺便启动一个监控线程,在服务器进程挂了的时候，帮助重启。"},{"type":"list_item","depth":4,"payload":{"lines":[18,19],"index":3},"content":"3. mysql.server 启动脚本,间接调用mysql_safe,在调用mysql.server时在后边指定start参数就可以启动服务器程序。 mysql.server start"},{"type":"list_item","depth":4,"payload":{"lines":[19,20],"index":4},"content":"4. mysqld_multi 对每一个服务器进程的启动和停止进行监控"}]}]},{"type":"heading","depth":2,"payload":{"lines":[20,21]},"content":"启动MySQL客户端程序","children":[{"type":"fence","depth":3,"content":"<pre class=\"language-shell\"><code class=\"language-shell\">mysql -h主机名 -u用户名 -p密码\n</code></pre>\n"}]},{"type":"heading","depth":2,"payload":{"lines":[25,26]},"content":"客户端与服务器连接的过程","children":[{"type":"heading","depth":3,"payload":{"lines":[26,27]},"content":"TCP/IP"}]},{"type":"heading","depth":2,"payload":{"lines":[28,29]},"content":"服务器处理客户端的请求"}]},{"type":"heading","depth":1,"payload":{"lines":[29,30]},"content":"启动选项和系统变量","children":[{"type":"heading","depth":2,"payload":{"lines":[30,31]},"content":"启动选项和配置文件","children":[{"type":"heading","depth":3,"payload":{"lines":[31,32]},"content":"在命令行上使用选项","children":[{"type":"fence","depth":4,"content":"<pre class=\"language-shell\"><code class=\"language-shell\">mysql --skip-networking\n</code></pre>\n"}]},{"type":"heading","depth":3,"payload":{"lines":[39,40]},"content":"配置文件使用选项","children":[{"type":"heading","depth":4,"payload":{"lines":[41,42]},"content":"配置文件路径"},{"type":"heading","depth":4,"payload":{"lines":[43,44]},"content":"配置文件内容"}]}]},{"type":"heading","depth":2,"payload":{"lines":[46,47]},"content":"系统变量","children":[{"type":"heading","depth":3,"payload":{"lines":[47,48]},"content":"简介"},{"type":"heading","depth":3,"payload":{"lines":[49,50]},"content":"查看系统变量","children":[{"type":"fence","depth":4,"content":"<pre class=\"language-shell\"><code class=\"language-shell\">show variables like <span class=\"token string\">'default_storage_engine'</span>\n</code></pre>\n"}]},{"type":"heading","depth":3,"payload":{"lines":[53,54]},"content":"设置系统变量","children":[{"type":"heading","depth":4,"payload":{"lines":[54,55]},"content":"通过启动选项设置"},{"type":"heading","depth":4,"payload":{"lines":[55,56]},"content":"服务器运行过程中设置","children":[{"type":"heading","depth":5,"payload":{"lines":[56,57]},"content":"设置不同作用范围的系统变量","children":[{"type":"list_item","depth":6,"payload":{"lines":[58,59],"index":1},"content":"1. GLOBL:全局变量,影响服务器的整体操作"},{"type":"list_item","depth":6,"payload":{"lines":[59,62],"index":2},"content":"2. SESSION:会话变量,影响某个客户端连接的操作<br>\n服务器启动时,会将每个全局变量初始化为其默认值。服务器会为每个客户端连接维护一组会话变量,客户端的会话变量在连接时使用相应全局变量的当前值初始化。<br>\n如果在设置系统变量的语句中省略了作用范围,<strong>默认的作用范围就是SESSION</strong>(这次的客户端连接)。"}]},{"type":"heading","depth":5,"payload":{"lines":[62,63]},"content":"查看不同作用范围的系统变量"}]}]}]},{"type":"heading","depth":2,"payload":{"lines":[64,65]},"content":"状态变量"}]},{"type":"heading","depth":1,"payload":{"lines":[68,69]},"content":"字符集和比较规则","children":[{"type":"heading","depth":2,"payload":{"lines":[69,70]},"content":"字符集和比较规则介绍","children":[{"type":"heading","depth":3,"payload":{"lines":[70,71]},"content":"字符集简介"},{"type":"heading","depth":3,"payload":{"lines":[72,73]},"content":"比较规则简介","children":[{"type":"list_item","depth":4,"payload":{"lines":[76,77],"index":1},"content":"1. 将两个大小写不同的字符全部转换为大写或者小写"},{"type":"list_item","depth":4,"payload":{"lines":[77,78],"index":2},"content":"2. 再比较这两个字符对应的二进制数据。"}]}]},{"type":"heading","depth":2,"payload":{"lines":[78,79]},"content":"字符集和比较规则的应用","children":[{"type":"heading","depth":3,"payload":{"lines":[79,80]},"content":"各级别的字符集和比较规则"},{"type":"heading","depth":3,"payload":{"lines":[80,81]},"content":"客户端和服务器通信过程中使用的字符集"},{"type":"heading","depth":3,"payload":{"lines":[81,82]},"content":"比较规则的应用"}]},{"type":"heading","depth":2,"payload":{"lines":[82,83]},"content":"总结","children":[{"type":"ordered_list","depth":3,"payload":{"lines":[83,94],"startIndex":1},"content":"","children":[{"type":"list_item","depth":4,"payload":{"lines":[83,84],"index":1},"content":"1. 字符集"},{"type":"list_item","depth":4,"payload":{"lines":[84,85],"index":2},"content":"2. 比较规则"},{"type":"list_item","depth":4,"payload":{"lines":[85,86],"index":3},"content":"3. 在MySQL中,一个字符集可以有若干种比较规则,其中有一个默认的比较规则,一个比较规则必须对应一个字符集"},{"type":"list_item","depth":4,"payload":{"lines":[86,89],"index":4},"content":"4. 查看MySQL支持的字符集和比较规则语句:<br>\nshow (charcter set|charset)[like 匹配的模式]<br>\nshow collation [like 匹配的模式]"},{"type":"list_item","depth":4,"payload":{"lines":[89,90],"index":5},"content":"5. MySQL有四个级别的字符集和比较规则","children":[{"type":"list_item","depth":5,"payload":{"lines":[90,91]},"content":"1 服务器级别"},{"type":"list_item","depth":5,"payload":{"lines":[91,92]},"content":"2 数据库级别"},{"type":"list_item","depth":5,"payload":{"lines":[92,93]},"content":"3 表级别"},{"type":"list_item","depth":5,"payload":{"lines":[93,94]},"content":"4 列级别"}]}]},{"type":"ordered_list","depth":3,"payload":{"lines":[95,97],"startIndex":6},"content":"","children":[{"type":"list_item","depth":4,"payload":{"lines":[95,96],"index":6},"content":"6. 从发送请求到接收结果过程中发生的字符集转换"},{"type":"list_item","depth":4,"payload":{"lines":[96,97],"index":7},"content":"7. 比较规则的作用通常体现在比较字符串大小的表达式和对某个字符串进行排序中"}]}]}]},{"type":"heading","depth":1,"payload":{"lines":[97,98]},"content":"InnoDB记录存储结构","children":[{"type":"heading","depth":2,"payload":{"lines":[100,101]},"content":"简介"},{"type":"heading","depth":2,"payload":{"lines":[102,103]},"content":"Compact格式"},{"type":"heading","depth":2,"payload":{"lines":[103,104]},"content":"Redundant行格式"},{"type":"heading","depth":2,"payload":{"lines":[104,105]},"content":"两者的异同"},{"type":"heading","depth":2,"payload":{"lines":[106,107]},"content":"行溢出数据"}]},{"type":"heading","depth":1,"payload":{"lines":[109,110]},"content":"InnoDB数据页结构","children":[{"type":"heading","depth":2,"payload":{"lines":[110,111]},"content":"不同类型的页"},{"type":"heading","depth":2,"payload":{"lines":[112,113]},"content":"数据页结构的快速浏览","children":[{"type":"list_item","depth":3,"payload":{"lines":[114,115],"index":1},"content":"1. File Header"},{"type":"list_item","depth":3,"payload":{"lines":[115,116],"index":2},"content":"2. Page Header"},{"type":"list_item","depth":3,"payload":{"lines":[116,117],"index":3},"content":"3. Infimum+supremum 两个虚拟的行记录 最大记录和最小记录"},{"type":"list_item","depth":3,"payload":{"lines":[117,118],"index":4},"content":"4. User Records 真实存储行记录内容"},{"type":"list_item","depth":3,"payload":{"lines":[118,119],"index":5},"content":"5. Free Space"},{"type":"list_item","depth":3,"payload":{"lines":[119,120],"index":6},"content":"6. Page Directory 页中的某些记录的相对位置"},{"type":"list_item","depth":3,"payload":{"lines":[120,121],"index":7},"content":"7. File Tailer"}]},{"type":"heading","depth":2,"payload":{"lines":[121,122]},"content":"记录在页中的存储","children":[{"type":"heading","depth":3,"payload":{"lines":[123,124]},"content":"记录头的构成","children":[{"type":"list_item","depth":4,"payload":{"lines":[124,125],"index":1},"content":"1. 预留位1"},{"type":"list_item","depth":4,"payload":{"lines":[125,126],"index":2},"content":"2. 预留位2"},{"type":"list_item","depth":4,"payload":{"lines":[126,127],"index":3},"content":"3. delete_mask 标记该记录是否被删除"},{"type":"list_item","depth":4,"payload":{"lines":[127,128],"index":4},"content":"4. min_rec_mask B+树的每层非叶子结点的最小记录"},{"type":"list_item","depth":4,"payload":{"lines":[128,129],"index":5},"content":"5. n_owned 表示当前拥有的记录数"},{"type":"list_item","depth":4,"payload":{"lines":[129,130],"index":6},"content":"6. heap_no 表示当前记录在记录堆中的位置"},{"type":"list_item","depth":4,"payload":{"lines":[130,131],"index":7},"content":"7. record_type 表示当前记录的类型"},{"type":"list_item","depth":4,"payload":{"lines":[131,133],"index":8},"content":"8. next_record 表示下一条记录的相对位置<br>\n其中比较重要的3个字段n_owned、heap_no和next_record书上讲的非常的详细"}]}]},{"type":"heading","depth":2,"payload":{"lines":[133,134]},"content":"Page Directory(页目录)"},{"type":"heading","depth":2,"payload":{"lines":[134,135]},"content":"Page Header(页面头部)"},{"type":"heading","depth":2,"payload":{"lines":[135,136]},"content":"File Header(文件头部)"},{"type":"heading","depth":2,"payload":{"lines":[136,137]},"content":"File Trailer(文件尾部)"},{"type":"heading","depth":2,"payload":{"lines":[137,138]},"content":"总结","children":[{"type":"ordered_list","depth":3,"payload":{"lines":[138,140],"startIndex":1},"content":"","children":[{"type":"list_item","depth":4,"payload":{"lines":[138,139],"index":1},"content":"1. InnoDB为了不同的目的设计了不同类型的页,我们把用于存放记录的页叫做数据页"},{"type":"list_item","depth":4,"payload":{"lines":[139,140],"index":2},"content":"2. 数据页大致被分为7个部分:"}]},{"type":"bullet_list","depth":3,"payload":{"lines":[140,147]},"content":"","children":[{"type":"list_item","depth":4,"payload":{"lines":[140,141]},"content":"File Header 表示页的一些通用信息,占固定的38字节"},{"type":"list_item","depth":4,"payload":{"lines":[141,142]},"content":"PageHeader 表示数据页专有的一些信息,占固定的56个字节"},{"type":"list_item","depth":4,"payload":{"lines":[142,143]},"content":"Infimum+Supremum 两个虚拟的伪记录,分别表示页中的最小和最大记录,占26个子节"},{"type":"list_item","depth":4,"payload":{"lines":[143,144]},"content":"User Records 真实存储我们插入的记录的部分,大小不固定"},{"type":"list_item","depth":4,"payload":{"lines":[144,145]},"content":"Free Space 页中尚未使用的部分"},{"type":"list_item","depth":4,"payload":{"lines":[145,146]},"content":"Page Diretory 页中某些记录的位置,对于数据页来说是每一组的最后一条记录"},{"type":"list_item","depth":4,"payload":{"lines":[146,147]},"content":"File Trailer 用于检验数据页是否完整(备份到磁盘过程断电的检验)"}]},{"type":"ordered_list","depth":3,"payload":{"lines":[147,152],"startIndex":3},"content":"","children":[{"type":"list_item","depth":4,"payload":{"lines":[147,148],"index":3},"content":"3. 记录会形成单链表"},{"type":"list_item","depth":4,"payload":{"lines":[148,150],"index":4},"content":"4. 查找记录的过程(必须完全理解)<br>\n提示:Page Directory+二分+next_record"},{"type":"list_item","depth":4,"payload":{"lines":[150,151],"index":5},"content":"5. FileHeader会使得所有数据页组成一个<strong>双链表</strong>"},{"type":"list_item","depth":4,"payload":{"lines":[151,152],"index":6},"content":"6. 校验和以及LSN值"}]}]}]},{"type":"heading","depth":1,"payload":{"lines":[152,153]},"content":"B+树索引","children":[{"type":"heading","depth":2,"payload":{"lines":[154,155]},"content":"为什么需要索引"},{"type":"heading","depth":2,"payload":{"lines":[160,161]},"content":"先从简单的索引方案开始"},{"type":"heading","depth":2,"payload":{"lines":[162,163]},"content":"InnoDB中的索引方案","children":[{"type":"heading","depth":3,"payload":{"lines":[165,166]},"content":"聚簇索引"},{"type":"heading","depth":3,"payload":{"lines":[167,168]},"content":"二级索引"},{"type":"heading","depth":3,"payload":{"lines":[169,170]},"content":"联合索引"}]},{"type":"heading","depth":2,"payload":{"lines":[171,172]},"content":"InnoDB的B+树索引的注意事项","children":[{"type":"list_item","depth":3,"payload":{"lines":[172,173],"index":1},"content":"1. 根结点不移动,移动的是页中的数据"},{"type":"list_item","depth":3,"payload":{"lines":[173,174],"index":2},"content":"2. 内节点(除去叶子节点)目录项记录的唯一性"},{"type":"list_item","depth":3,"payload":{"lines":[174,175],"index":3},"content":"3. 一个页面最少存储2条记录"}]},{"type":"heading","depth":2,"payload":{"lines":[175,176]},"content":"MyISAM中的索引方案简单介绍"},{"type":"heading","depth":2,"payload":{"lines":[177,178]},"content":"创建和删除索引的语句","children":[{"type":"fence","depth":3,"content":"<pre class=\"language-mysql\"><code class=\"language-mysql\">create table index_demo{\n    c1 int,\n    c2 int,\n    c3 char(1),\n    primary key(c1), \n    index idx_c2_c3 (c2,c3)\n}\n</code></pre>\n"},{"type":"fence","depth":3,"content":"<pre class=\"language-mysql\"><code class=\"language-mysql\">alter table table_name add [index|key] 索引名(需要被索引的单个列或多个列)\n</code></pre>\n"}]}]},{"type":"heading","depth":1,"payload":{"lines":[193,194]},"content":"学会使用B+树索引","children":[{"type":"heading","depth":2,"payload":{"lines":[194,195]},"content":"索引的代价"},{"type":"heading","depth":2,"payload":{"lines":[195,196]},"content":"B+树索引的适用条件","children":[{"type":"heading","depth":3,"payload":{"lines":[196,197]},"content":"全值匹配"},{"type":"heading","depth":3,"payload":{"lines":[198,199]},"content":"匹配左边的列"},{"type":"heading","depth":3,"payload":{"lines":[200,201]},"content":"匹配前缀","children":[{"type":"fence","depth":4,"content":"<pre class=\"language-mysql\"><code class=\"language-mysql\">SELECT * FROM person_info WHERE name LIKE 'As%';\n</code></pre>\n"}]},{"type":"heading","depth":3,"payload":{"lines":[205,206]},"content":"匹配范围值","children":[{"type":"fence","depth":4,"content":"<pre class=\"language-mysql\"><code class=\"language-mysql\">select * from person_info where name &gt;'Asa' and name&lt;'Barlow';\n</code></pre>\n"}]},{"type":"heading","depth":3,"payload":{"lines":[212,213]},"content":"精确匹配某一列并范围匹配另一列"},{"type":"heading","depth":3,"payload":{"lines":[214,215]},"content":"用于排序","children":[{"type":"fence","depth":4,"content":"<pre class=\"language-mysql\"><code class=\"language-mysql\">select * from person_info order by name,birthday,phone_number limit 10;\n</code></pre>\n"}]},{"type":"heading","depth":3,"payload":{"lines":[219,220]},"content":"用于分组","children":[{"type":"fence","depth":4,"content":"<pre class=\"language-mysql\"><code class=\"language-mysql\">select name,birthday,phone_number,count(*) from person_info group by name,birthday,phone_number\n</code></pre>\n"}]}]}]},{"type":"heading","depth":1,"payload":{"lines":[224,225]},"content":"MySQL的数据目录","children":[{"type":"heading","depth":2,"payload":{"lines":[225,226]},"content":"文件系统"},{"type":"heading","depth":2,"payload":{"lines":[227,228]},"content":"MySQL数据目录","children":[{"type":"heading","depth":3,"payload":{"lines":[228,229]},"content":"安装目录与数据目录"},{"type":"heading","depth":3,"payload":{"lines":[230,231]},"content":"如何查看数据目录"}]},{"type":"heading","depth":2,"payload":{"lines":[232,233]},"content":"数据目录的结构","children":[{"type":"heading","depth":3,"payload":{"lines":[233,234]},"content":"数据库在文件在文件系统中的表示"},{"type":"heading","depth":3,"payload":{"lines":[235,236]},"content":"表文件在文件系统中的表示","children":[{"type":"heading","depth":4,"payload":{"lines":[237,238]},"content":"表结构文件"},{"type":"heading","depth":4,"payload":{"lines":[238,239]},"content":"表数据文件","children":[{"type":"heading","depth":5,"payload":{"lines":[239,240]},"content":"系统表空间"},{"type":"heading","depth":5,"payload":{"lines":[241,242]},"content":"独立表空间"}]},{"type":"heading","depth":4,"payload":{"lines":[244,245]},"content":"MyISAM是如何存储数据的"}]},{"type":"heading","depth":3,"payload":{"lines":[247,248]},"content":"试图在文件系统中的表示"},{"type":"heading","depth":3,"payload":{"lines":[249,250]},"content":"其他的文件"}]},{"type":"heading","depth":2,"payload":{"lines":[253,254]},"content":"文件系统对数据库的影响"}]},{"type":"heading","depth":1,"payload":{"lines":[258,259]},"content":"存放页面的池子-InnoDB的表空间","children":[{"type":"heading","depth":2,"payload":{"lines":[260,261]},"content":"复习有关页的知识","children":[{"type":"heading","depth":3,"payload":{"lines":[261,262]},"content":"页面类型"},{"type":"heading","depth":3,"payload":{"lines":[263,264]},"content":"页面通用部分","children":[{"type":"heading","depth":4,"payload":{"lines":[264,265]},"content":"FileHeader的组成部分"}]}]},{"type":"heading","depth":2,"payload":{"lines":[267,268]},"content":"独立表空间","children":[{"type":"heading","depth":3,"payload":{"lines":[269,270]},"content":"区(Extend)","children":[{"type":"heading","depth":4,"payload":{"lines":[275,276]},"content":"为什么引入区？"}]},{"type":"heading","depth":3,"payload":{"lines":[277,278]},"content":"段","children":[{"type":"list_item","depth":4,"payload":{"lines":[283,284],"index":1},"content":"1. 在刚开始向表中插入数据的时候,段是从某个碎片区以单个页面为单位来分配存储空间"},{"type":"list_item","depth":4,"payload":{"lines":[284,285],"index":2},"content":"2. 当某个段已经占用了32个碎片页的时候,就会以完整的区为单位来分配存储单位"}]},{"type":"heading","depth":3,"payload":{"lines":[285,286]},"content":"区的分类","children":[{"type":"heading","depth":4,"payload":{"lines":[294,295]},"content":"哪些区属于哪个段"},{"type":"heading","depth":4,"payload":{"lines":[298,299]},"content":"链表基节点"}]},{"type":"heading","depth":3,"payload":{"lines":[300,301]},"content":"段的结构"},{"type":"heading","depth":3,"payload":{"lines":[302,303]},"content":"各类型页面详细情况","children":[{"type":"heading","depth":4,"payload":{"lines":[304,305]},"content":"FSP_HDR类型","children":[{"type":"heading","depth":5,"payload":{"lines":[305,306]},"content":"File Space Header"}]}]},{"type":"heading","depth":3,"payload":{"lines":[308,309]},"content":"Segment Header"},{"type":"heading","depth":3,"payload":{"lines":[310,311]},"content":"真实表空间对应的文件大小"}]},{"type":"heading","depth":2,"payload":{"lines":[312,313]},"content":"系统表空间"}]},{"type":"heading","depth":1,"payload":{"lines":[315,316]},"content":"单表访问方法","children":[{"type":"heading","depth":2,"payload":{"lines":[318,319]},"content":"执行方法(access method)","children":[{"type":"list_item","depth":3,"payload":{"lines":[320,321]},"content":"使用全表搜索"},{"type":"list_item","depth":3,"payload":{"lines":[321,322]},"content":"使用索引进行查询,可以细分为很多种类","children":[{"type":"list_item","depth":4,"payload":{"lines":[322,323]},"content":"针对主键或唯一二级索引的等值查询(唯一)"},{"type":"list_item","depth":4,"payload":{"lines":[323,324]},"content":"针对普通二级索引的等值查询(范围)"},{"type":"list_item","depth":4,"payload":{"lines":[324,325]},"content":"针对索引列的范围查询(范围)"},{"type":"list_item","depth":4,"payload":{"lines":[325,327]},"content":"直接扫描整个索引<br>\n针对上面的这几种细分的查询方式,MySQL将其称为<strong>访问方法</strong>或者<strong>访问类型</strong>。"}]}]},{"type":"heading","depth":2,"payload":{"lines":[327,328]},"content":"const(常量级别)"},{"type":"heading","depth":2,"payload":{"lines":[329,330]},"content":"ref","children":[{"type":"fence","depth":3,"content":"<pre class=\"language-mysql\"><code class=\"language-mysql\">select * from single_table where key1='abc'\n</code></pre>\n"}]},{"type":"heading","depth":2,"payload":{"lines":[334,335]},"content":"ref_or_null"},{"type":"heading","depth":2,"payload":{"lines":[336,337]},"content":"range"},{"type":"heading","depth":2,"payload":{"lines":[339,340]},"content":"index"},{"type":"heading","depth":2,"payload":{"lines":[341,342]},"content":"all"},{"type":"heading","depth":2,"payload":{"lines":[342,343]},"content":"注意事项","children":[{"type":"heading","depth":3,"payload":{"lines":[343,344]},"content":"二级索引+回表"},{"type":"heading","depth":3,"payload":{"lines":[344,345]},"content":"明确range范围","children":[{"type":"heading","depth":4,"payload":{"lines":[346,347]},"content":"所有搜索条件都可以使用某个索引的情况"},{"type":"heading","depth":4,"payload":{"lines":[348,349]},"content":"有的查询条件无法使用索引的情况","children":[{"type":"fence","depth":5,"content":"<pre class=\"language-mysql\"><code class=\"language-mysql\">select * from single_table where key2&gt;100 and common_field='abc'\n</code></pre>\n"}]},{"type":"heading","depth":4,"payload":{"lines":[353,354]},"content":"复杂搜索条件下找出范围匹配的区间"}]},{"type":"heading","depth":3,"payload":{"lines":[355,356]},"content":"索引合并","children":[{"type":"heading","depth":4,"payload":{"lines":[357,358]},"content":"Intersection合并","children":[{"type":"heading","depth":5,"payload":{"lines":[360,361]},"content":"适用情况","children":[{"type":"list_item","depth":6,"payload":{"lines":[361,362],"index":1},"content":"1. 二级索引等值匹配"},{"type":"list_item","depth":6,"payload":{"lines":[362,363],"index":2},"content":"2. 主键列范围匹配(主键列指定范围,二级索引等值)"}]}]},{"type":"heading","depth":4,"payload":{"lines":[363,364]},"content":"Union合并","children":[{"type":"heading","depth":5,"payload":{"lines":[366,367]},"content":"适用情况","children":[{"type":"list_item","depth":6,"payload":{"lines":[367,368],"index":1},"content":"1. 二级索引等值匹配"},{"type":"list_item","depth":6,"payload":{"lines":[368,369],"index":2},"content":"2. 主键列范围匹配(主键列指定范围,二级索引等值)"},{"type":"list_item","depth":6,"payload":{"lines":[369,370],"index":3},"content":"3. 取交集的索引合并的搜索条件"}]}]},{"type":"heading","depth":4,"payload":{"lines":[370,371]},"content":"Sort-Union合并"}]}]}]},{"type":"heading","depth":1,"payload":{"lines":[372,373]},"content":"连接的原理","children":[{"type":"heading","depth":2,"payload":{"lines":[373,374]},"content":"连接简介","children":[{"type":"heading","depth":3,"payload":{"lines":[374,375]},"content":"连接的本质"},{"type":"heading","depth":3,"payload":{"lines":[375,376]},"content":"连接过程"},{"type":"heading","depth":3,"payload":{"lines":[380,381]},"content":"内连接和外连接","children":[{"type":"heading","depth":4,"payload":{"lines":[381,382]},"content":"区别"},{"type":"heading","depth":4,"payload":{"lines":[384,385]},"content":"where过滤条件与on过滤条件"}]}]},{"type":"heading","depth":2,"payload":{"lines":[386,387]},"content":"连接的原理","children":[{"type":"heading","depth":3,"payload":{"lines":[387,388]},"content":"嵌套循环连接"},{"type":"heading","depth":3,"payload":{"lines":[389,390]},"content":"使用索引加快查询速度"},{"type":"heading","depth":3,"payload":{"lines":[391,392]},"content":"基于块的循环嵌套连接"}]}]},{"type":"heading","depth":1,"payload":{"lines":[395,396]},"content":"MySQL基于成本的优化","children":[{"type":"heading","depth":2,"payload":{"lines":[396,397]},"content":"什么是成本"},{"type":"heading","depth":2,"payload":{"lines":[400,401]},"content":"单表查询的成本","children":[{"type":"heading","depth":3,"payload":{"lines":[401,402]},"content":"基于成本的优化步骤","children":[{"type":"heading","depth":4,"payload":{"lines":[407,408]},"content":"show index"}]},{"type":"heading","depth":3,"payload":{"lines":[413,414]},"content":"连接查询的成本"},{"type":"heading","depth":3,"payload":{"lines":[415,416]},"content":"调节成本常数"}]}]},{"type":"heading","depth":1,"payload":{"lines":[419,420]},"content":"InnoDB的统计数据如何收集","children":[{"type":"heading","depth":2,"payload":{"lines":[421,422]},"content":"两种不同的统计数据存储方式"},{"type":"heading","depth":2,"payload":{"lines":[427,428]},"content":"基于磁盘的永久性统计数据"}]},{"type":"heading","depth":1,"payload":{"lines":[431,432]},"content":"MySQL基于规则的优化","children":[{"type":"heading","depth":2,"payload":{"lines":[432,433]},"content":"条件化简","children":[{"type":"heading","depth":3,"payload":{"lines":[433,434]},"content":"去除多余的括号"},{"type":"heading","depth":3,"payload":{"lines":[434,435]},"content":"常量传递"},{"type":"heading","depth":3,"payload":{"lines":[435,436]},"content":"等值传递"},{"type":"heading","depth":3,"payload":{"lines":[436,437]},"content":"移除没用的条件"},{"type":"heading","depth":3,"payload":{"lines":[437,438]},"content":"表达式计算"},{"type":"heading","depth":3,"payload":{"lines":[439,440]},"content":"HAVING子句和WHERE子句的合并"},{"type":"heading","depth":3,"payload":{"lines":[441,442]},"content":"常量表检测","children":[{"type":"fence","depth":4,"content":"<pre class=\"language-mysql\"><code class=\"language-mysql\">select * from table1 inner join table2 on table1.column1=table2.column2\nwhere table1.primary_key=1;\n</code></pre>\n"},{"type":"fence","depth":4,"content":"<pre class=\"language-mysql\"><code class=\"language-mysql\">select table1表记录的各个字段的常量值,table2.* from table1 inner join table2 on table1表column1列的常量值=table2.column2;\n</code></pre>\n"}]}]},{"type":"heading","depth":2,"payload":{"lines":[451,452]},"content":"外连接消除"},{"type":"heading","depth":2,"payload":{"lines":[453,454]},"content":"子查询优化","children":[{"type":"heading","depth":3,"payload":{"lines":[454,455]},"content":"子查询语法","children":[{"type":"heading","depth":4,"payload":{"lines":[455,456]},"content":"子查询类型","children":[{"type":"heading","depth":5,"payload":{"lines":[456,457]},"content":"按返回的结果集区分子查询","children":[{"type":"list_item","depth":6,"payload":{"lines":[457,459],"index":1},"content":"1. 标量子查询<br>\n返回单一值的子查询称之为<strong>标量子查询</strong>,一行一列的数据"},{"type":"list_item","depth":6,"payload":{"lines":[459,461],"index":2},"content":"2. 行子查询<br>\n一条记录"},{"type":"list_item","depth":6,"payload":{"lines":[461,462],"index":3},"content":"3. 列子查询"},{"type":"list_item","depth":6,"payload":{"lines":[462,464],"index":4},"content":"4. 表子查询<br>\n多条记录"}]},{"type":"heading","depth":5,"payload":{"lines":[464,465]},"content":"按与外层查询关系来区分子查询","children":[{"type":"list_item","depth":6,"payload":{"lines":[465,467],"index":1},"content":"1. 不相关子查询<br>\n子查询单独可以出结果"},{"type":"list_item","depth":6,"payload":{"lines":[467,468],"index":2},"content":"2. 相关子查询"}]}]},{"type":"heading","depth":4,"payload":{"lines":[468,469]},"content":"子查询在布尔表达式中使用"},{"type":"heading","depth":4,"payload":{"lines":[469,470]},"content":"子查询语法注意事项"}]},{"type":"heading","depth":3,"payload":{"lines":[470,471]},"content":"子查询在MySQL中如何执行","children":[{"type":"ordered_list","depth":4,"payload":{"lines":[472,475],"startIndex":1},"content":"","children":[{"type":"list_item","depth":5,"payload":{"lines":[472,473],"index":1},"content":"1. 如果是不相关子查询的话,那么就是先执行子查询中的语句，将结果集作为外层查询可能将要用到的数据集。"},{"type":"list_item","depth":5,"payload":{"lines":[473,475],"index":2},"content":"2. 如果是相关查询，那么先从外层查询中拿出一条数据，用对应的值和子查询的列做关联。<br>\n事实也正是如此,但是MySQL会在此基础上进行优化"}]},{"type":"heading","depth":4,"payload":{"lines":[475,476]},"content":"IN子查询优化","children":[{"type":"ordered_list","depth":5,"payload":{"lines":[477,484],"startIndex":1},"content":"","children":[{"type":"list_item","depth":6,"payload":{"lines":[477,478],"index":1},"content":"1. 该临时表的列就是子查询结果集中的列。"},{"type":"list_item","depth":6,"payload":{"lines":[478,479],"index":2},"content":"2. 写入临时表的记录会被去重。"},{"type":"list_item","depth":6,"payload":{"lines":[479,484],"index":3},"content":"3. 如果数据不是大的离谱,那么就会建立基于内存的使用Memory存储引擎的临时表,而且会为该表建立哈希索引;如果过大就会建立基于磁盘的存储引擎。<br>\n上面这种方案被称之为<strong>物化表</strong>,可以将物化表转换为连接<br>\nMySQL设计者又提出<strong>半连接</strong>(semi-join),这是<strong>MySQL内部的一种查询方式</strong>,下面是书上对于半连接的详细描述<br>\n对于s1表的某条记录来说,我们只关心在s2表中是否存在与之匹配的记录，而不关心具体有多少条记录与之匹配,最终的结果集中只保留s1表的记录。<br>\n有5种实现semi-join的策略"}]},{"type":"heading","depth":5,"payload":{"lines":[484,485]},"content":"总结","children":[{"type":"ordered_list","depth":6,"payload":{"lines":[485,487],"startIndex":1},"content":"","children":[{"type":"list_item","depth":7,"payload":{"lines":[485,486],"index":1},"content":"1. 如果in子查询符合转换semi-join的条件,查询优化器会优先把该子查询为semi-join,然后从5种执行策略中选择成本更低的一种。"},{"type":"list_item","depth":7,"payload":{"lines":[486,487],"index":2},"content":"2. 如果in子查询不符合转换为semi-join的条件,那么查询优化器会从下边两种策略选择一种成本更低的方式"}]},{"type":"bullet_list","depth":6,"payload":{"lines":[487,489]},"content":"","children":[{"type":"list_item","depth":7,"payload":{"lines":[487,488]},"content":"先将子查询物化之后再查询"},{"type":"list_item","depth":7,"payload":{"lines":[488,489]},"content":"执行in to exists"}]}]}]},{"type":"heading","depth":4,"payload":{"lines":[489,490]},"content":"[NOT] EXISTS子查询的执行","children":[{"type":"list_item","depth":5,"payload":{"lines":[490,491],"index":1},"content":"1. 如果不相关,会用true或者false来替换掉exists条件;"},{"type":"list_item","depth":5,"payload":{"lines":[491,492],"index":2},"content":"2. 如果相关,就只能用一开始的方式来执行，但是会用索引加快"}]},{"type":"heading","depth":4,"payload":{"lines":[492,493]},"content":"对于派生表的优化","children":[{"type":"list_item","depth":5,"payload":{"lines":[493,494],"index":1},"content":"1. 将派生表物化"},{"type":"list_item","depth":5,"payload":{"lines":[494,495],"index":2},"content":"2. 将派生表和外层的表合并,就是将查询重写为没有派生表的形式"}]}]}]}]}],"payload":{}},{})</script>
</body>
</html>
