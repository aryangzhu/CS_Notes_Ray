
# 重新认识MySQL
## 客户端/服务器架构
## MySQL的安装
### bin目录下的可执行文件
## 启动MySQL服务器程序
### UNIX里启动服务器程序
1. mysqld 可以启动一个服务器进程
2. mysqld_safe  启动脚本,间接调用mysqld,顺便启动一个监控线程,在服务器进程挂了的时候，帮助重启。
3. mysql.server 启动脚本,间接调用mysql_safe,在调用mysql.server时在后边指定start参数就可以启动服务器程序。 mysql.server start
4. mysqld_multi 对每一个服务器进程的启动和停止进行监控
## 启动MySQL客户端程序
```shell
mysql -h主机名 -u用户名 -p密码
```
本上是一个进程间通信的过程
## 客户端与服务器连接的过程
### TCP/IP
如果使用TCP/IP网络来连接到服务器进程,就需要在启动客户端程序时在-h后面使用IP地址来作为需要连接的服务器进程所在主机的主机名。
## 服务器处理客户端的请求
# 启动选项和系统变量
## 启动选项和配置文件
### 在命令行上使用选项
例如,启动时禁止使用TCP/IP网络通信。  
```shell
mysql --skip-networking
```
指定启动选项时需要加上--前缀。另外如果选项名是由多个单词构成的,他们之间可以由短划线-连接起来。比如,skip-networking和skip_networking表示的含义是相同的。
还有一个例子是启动时设置表的存储引擎  
书上还强调了一下选项的长形式和短形式,例如--host -h主机名这样式儿的
### 配置文件使用选项
因为启动时命令行选项只在本次起作用,所以放在配置文件中永久生效
#### 配置文件路径
这块对于类unix的路径进行描述
#### 配置文件内容
分组进行配置,各个启动命令也有能读取的组的限制。
注:如果同一个启动选项即出现在命令行中,又出现在配置文件中,那么以命令行的启动选项为准。
# 系统变量
## 简介
在服务器程序运行过程中能对其造成影响的变量。
## 查看系统变量
```shell
show variables like 'default_storage_engine'
```
## 设置系统变量
### 通过启动选项设置
### 服务器运行过程中设置
#### 设置不同作用范围的系统变量
书上提到了两个概念或者说是两个范围,一个是global,另一个是session。
1. GLOBL:全局变量,影响服务器的整体操作  
2. SESSION:会话变量,影响某个客户端连接的操作  
服务器启动时,会将每个全局变量初始化为其默认值。服务器会为每个客户端连接维护一组会话变量,客户端的会话变量在连接时使用相应全局变量的当前值初始化。
如果在设置系统变量的语句中省略了作用范围,**默认的作用范围就是SESSION**(这次的客户端连接)。  
#### 查看不同作用范围的系统变量
同样也是使用show varaibles like 'default_storage_engine'
## 状态变量
为了检测服务器程序的运行情况而存在的变量,由此而知,它们的值是由服务器程序来设置的。
show status like 'thread%'  
状态变量也有global和session两个作用范围。
# 字符集和比较规则
## 字符集和比较规则介绍
### 字符集简介
将二进制数据转换为字符所用的这套转换规则就是字符集
### 比较规则简介
a-0x01 b-0x02   
上面的字符如果以二进制数据自身的比较规则来进行比较的话,那么大多数时候是不符合场景需求的。  
'a'和'A'进行比较时:
1. 将两个大小写不同的字符全部转换为大写或者小写  
2. 再比较这两个字符对应的二进制数据。
## 字符集和比较规则的应用
### 各级别的字符集和比较规则
### 客户端和服务器通信过程中使用的字符集
### 比较规则的应用
## 总结
1. 字符集
2. 比较规则
3. 在MySQL中,一个字符集可以有若干种比较规则,其中有一个默认的比较规则,一个比较规则必须对应一个字符集
4. 查看MySQL支持的字符集和比较规则语句:
show (charcter set|charset)[like 匹配的模式]  
show collation [like 匹配的模式]  
5. MySQL有四个级别的字符集和比较规则
   + 1 服务器级别
   + 2 数据库级别
   + 3 表级别
   + 4 列级别
---
6. 从发送请求到接收结果过程中发生的字符集转换
7. 比较规则的作用通常体现在比较字符串大小的表达式和对某个字符串进行排序中
# InnoDB记录存储结构
虽然书上已经讲得十分通俗了,奈何我学的还是非常吃力,找了一篇博客,觉得还不错。  
https://draveness.me/mysql-innodb/
## 简介
将数据划分为若干个页,以页作为磁盘和内存之间交互的工作单位,InnoDB中页的大小一般为16KB.
## Compact格式
## Redundant行格式
## 两者的异同
最大的不同就是compact在行记录的第一部分倒序存放了一行数据中列的长度(Length),而Redundant中存的是每一列的偏移量(Offset)
## 行溢出数据
当InnoDB使用Compact或者Redundant格式**存储极长的VARCHAR或者BLOB这类大对象时**,我们**并不会直接将所有的内容都存放在数据页节点中**,而是将行数据中的前768个字节存储在数据页中,后面会通过偏移量指向溢出页。  
当使用新的记录格式Compressed或者Dynamic时都会只在行记录中保存20个子节的指针,**实际的数据都会存放在溢出页面中**。
# InnoDB数据页结构
## 不同类型的页
为了不同的目的设计了许多种不同类型的页,比如存放头部信息的页,存放Insert Buffer信息的,存放index信息的页,存放undo日志信息的页等
## 数据页结构的快速浏览
数据页代表的这块16KB大小的存储空间可以被划分多个部分,不同的部分有不同的功能  
1. File Header
2. Page Header
3. Infimum+supremum 两个虚拟的行记录 最大记录和最小记录
4. User Records 真实存储行记录内容
5. Free Space
6. Page Directory 页中的某些记录的相对位置  
7. File Tailer
## 记录在页中的存储
### 记录头的构成
1. 预留位1
2. 预留位2
3. delete_mask 标记该记录是否被删除  
4. min_rec_mask B+树的每层非叶子结点的最小记录
5. n_owned 表示当前拥有的记录数
6. heap_no 表示当前记录在记录堆中的位置
7. record_type 表示当前记录的类型
8. next_record 表示下一条记录的相对位置 
## Page Directory(页目录)
## Page Header(页面头部)
## File Header(文件头部)
## File Trailer(文件尾部)
## 总结
