<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta http-equiv="X-UA-Compatible" content="ie=edge">
<title>Markmap</title>
<style>
* {
  margin: 0;
  padding: 0;
}
#mindmap {
  display: block;
  width: 100vw;
  height: 100vh;
}
</style>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/prismjs@1.28.0/themes/prism.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/markmap-toolbar@0.13.5/dist/style.css">
</head>
<body>
<svg id="mindmap"></svg>
<script src="https://cdn.jsdelivr.net/npm/d3@6.7.0"></script><script src="https://cdn.jsdelivr.net/npm/markmap-view@0.13.5"></script><script src="https://cdn.jsdelivr.net/npm/markmap-toolbar@0.13.5/dist/index.umd.min.js"></script><script>(r => {
                setTimeout(r);
              })(() => {
  const {
    markmap,
    mm
  } = window;
  const toolbar = new markmap.Toolbar();
  toolbar.attach(mm);
  const el = toolbar.render();
  el.setAttribute('style', 'position:absolute;bottom:20px;right:20px');
  document.body.append(el);
})</script><script>((getMarkmap, getOptions, root, jsonOptions) => {
        const markmap = getMarkmap();
        window.mm = markmap.Markmap.create('svg#mindmap', (getOptions || markmap.deriveOptions)(jsonOptions), root);
      })(() => window.markmap,null,{"type":"root","depth":0,"content":"","children":[{"type":"heading","depth":1,"payload":{"lines":[0,1]},"content":"第一章 走入并行","children":[{"type":"heading","depth":2,"payload":{"lines":[1,2]},"content":"必须知道的几个概念","children":[{"type":"heading","depth":3,"payload":{"lines":[2,3]},"content":"同步和异步"},{"type":"heading","depth":3,"payload":{"lines":[5,6]},"content":"并发与并行"},{"type":"heading","depth":3,"payload":{"lines":[8,9]},"content":"临界区"},{"type":"heading","depth":3,"payload":{"lines":[10,11]},"content":"阻塞与非阻塞"},{"type":"heading","depth":3,"payload":{"lines":[12,13]},"content":"死锁、饥饿、活锁","children":[{"type":"heading","depth":4,"payload":{"lines":[13,14]},"content":"死锁"},{"type":"heading","depth":4,"payload":{"lines":[24,25]},"content":"饥饿"},{"type":"heading","depth":4,"payload":{"lines":[26,27]},"content":"活锁"}]}]},{"type":"heading","depth":2,"payload":{"lines":[28,29]},"content":"并发级别","children":[{"type":"heading","depth":3,"payload":{"lines":[29,30]},"content":"阻塞"},{"type":"heading","depth":3,"payload":{"lines":[31,32]},"content":"无饥饿"},{"type":"heading","depth":3,"payload":{"lines":[33,34]},"content":"无障碍"},{"type":"heading","depth":3,"payload":{"lines":[36,37]},"content":"无锁"},{"type":"heading","depth":3,"payload":{"lines":[39,40]},"content":"无等待"}]},{"type":"heading","depth":2,"payload":{"lines":[42,43]},"content":"并行有关的两个定律","children":[{"type":"heading","depth":3,"payload":{"lines":[43,44]},"content":"Amdahal定律"},{"type":"heading","depth":3,"payload":{"lines":[44,45]},"content":"Gustafson定律"}]},{"type":"heading","depth":2,"payload":{"lines":[45,46]},"content":"回到Java:JMM","children":[{"type":"heading","depth":3,"payload":{"lines":[47,48]},"content":"原子性(Atomicity)"},{"type":"heading","depth":3,"payload":{"lines":[49,50]},"content":"可见性(Visibility)"},{"type":"heading","depth":3,"payload":{"lines":[51,52]},"content":"有序性(Ordering)","children":[{"type":"heading","depth":4,"payload":{"lines":[53,54]},"content":"哪些指令不能重排","children":[{"type":"heading","depth":5,"payload":{"lines":[54,55]},"content":"程序顺序原则"},{"type":"heading","depth":5,"payload":{"lines":[56,57]},"content":"volatile规则"},{"type":"heading","depth":5,"payload":{"lines":[58,59]},"content":"锁规则","children":[{"type":"heading","depth":6,"payload":{"lines":[60,61]},"content":"传递性"}]},{"type":"heading","depth":5,"payload":{"lines":[63,64]},"content":"线程的start()先于它的每一个动作"},{"type":"heading","depth":5,"payload":{"lines":[65,66]},"content":"线程的所有操作先于线程的终结(Thread.join())"},{"type":"heading","depth":5,"payload":{"lines":[66,67]},"content":"线程的中断(interrupt())先于被中断线程的代码"},{"type":"heading","depth":5,"payload":{"lines":[67,68]},"content":"对象的构造函数执行、结束于finalize()方法"}]}]}]}]},{"type":"heading","depth":1,"payload":{"lines":[69,70]},"content":"第二章 Java并行程序基础","children":[{"type":"heading","depth":2,"payload":{"lines":[70,71]},"content":"有关线程必知的事","children":[{"type":"heading","depth":3,"payload":{"lines":[71,72]},"content":"进程与线程"}]},{"type":"heading","depth":2,"payload":{"lines":[75,76]},"content":"初始线程：线程的基本操作","children":[{"type":"heading","depth":3,"payload":{"lines":[76,77]},"content":"新建"},{"type":"heading","depth":3,"payload":{"lines":[77,78]},"content":"中止"},{"type":"heading","depth":3,"payload":{"lines":[78,79]},"content":"中断"},{"type":"heading","depth":3,"payload":{"lines":[79,80]},"content":"等待(wait)与唤醒(通知 notify)"},{"type":"heading","depth":3,"payload":{"lines":[81,82]},"content":"挂起(suspend)与继续执行(resume)"},{"type":"heading","depth":3,"payload":{"lines":[82,83]},"content":"等待线程结束(join)与谦让(yield)"}]},{"type":"heading","depth":2,"payload":{"lines":[83,84]},"content":"volatile与JMM(Java内存模型)"},{"type":"heading","depth":2,"payload":{"lines":[84,85]},"content":"分门别类的管理(线程组)"},{"type":"heading","depth":2,"payload":{"lines":[85,86]},"content":"驻守后台的线程(守护线程)"},{"type":"heading","depth":2,"payload":{"lines":[86,87]},"content":"先干重要的事(线程优先级)"},{"type":"heading","depth":2,"payload":{"lines":[87,88]},"content":"线程安全的概念与synchronized"},{"type":"heading","depth":2,"payload":{"lines":[88,89]},"content":"程序中的幽灵(隐蔽的错误)"}]},{"type":"heading","depth":1,"payload":{"lines":[89,90]},"content":"第三章 JDK下的并发包","children":[{"type":"heading","depth":2,"payload":{"lines":[90,91]},"content":"同步控制","children":[{"type":"heading","depth":3,"payload":{"lines":[91,92]},"content":"synchronized的功能扩展ReentrantLock(可重入锁)","children":[{"type":"heading","depth":4,"payload":{"lines":[92,93]},"content":"中断响应"},{"type":"heading","depth":4,"payload":{"lines":[99,100]},"content":"锁申请等待限时"},{"type":"heading","depth":4,"payload":{"lines":[100,101]},"content":"公平锁"},{"type":"heading","depth":4,"payload":{"lines":[101,102]},"content":"ReentrantLock常用API","children":[{"type":"heading","depth":5,"payload":{"lines":[102,103]},"content":"lock()"},{"type":"heading","depth":5,"payload":{"lines":[104,105]},"content":"lockInterruptibly()"},{"type":"heading","depth":5,"payload":{"lines":[106,107]},"content":"tryLock()"},{"type":"heading","depth":5,"payload":{"lines":[108,109]},"content":"tryLock(long time,TimeUnit unit)"},{"type":"heading","depth":5,"payload":{"lines":[110,111]},"content":"unlock()"}]}]},{"type":"heading","depth":3,"payload":{"lines":[112,113]},"content":"重入锁的搭档:Condition条件","children":[{"type":"heading","depth":4,"payload":{"lines":[113,114]},"content":"常用API","children":[{"type":"heading","depth":5,"payload":{"lines":[114,115]},"content":"await()"},{"type":"heading","depth":5,"payload":{"lines":[116,117]},"content":"awaitUniterruptibly()"},{"type":"heading","depth":5,"payload":{"lines":[118,119]},"content":"singal()"}]},{"type":"heading","depth":4,"payload":{"lines":[120,121]},"content":"ArrayBlockingQueue的put方法"}]},{"type":"heading","depth":3,"payload":{"lines":[121,122]},"content":"允许多个线程同时访问:信号量(Semaphore)","children":[{"type":"heading","depth":4,"payload":{"lines":[122,123]},"content":"常用API","children":[{"type":"heading","depth":5,"payload":{"lines":[124,125]},"content":"public Semaphore(int permits)"},{"type":"heading","depth":5,"payload":{"lines":[125,126]},"content":"public Semaphore(int permits,boolean fair)"},{"type":"heading","depth":5,"payload":{"lines":[128,129]},"content":"public void acquire()"},{"type":"heading","depth":5,"payload":{"lines":[130,131]},"content":"public void acquireUninterruptibly()"},{"type":"heading","depth":5,"payload":{"lines":[132,133]},"content":"public boolean tryAcquire()"},{"type":"heading","depth":5,"payload":{"lines":[134,135]},"content":"public boolean tryAcquire(long timeout,TimeUnit unit)"},{"type":"heading","depth":5,"payload":{"lines":[135,136]},"content":"public void release()"}]}]},{"type":"heading","depth":3,"payload":{"lines":[137,138]},"content":"ReadWriteLock读写锁"},{"type":"heading","depth":3,"payload":{"lines":[142,143]},"content":"倒计时器CountDownLatch","children":[{"type":"heading","depth":4,"payload":{"lines":[144,145]},"content":"常用API","children":[{"type":"heading","depth":5,"payload":{"lines":[145,146]},"content":"countDown()"},{"type":"heading","depth":5,"payload":{"lines":[146,147]},"content":"CountDownLatch(int count)"}]}]},{"type":"heading","depth":3,"payload":{"lines":[147,148]},"content":"循环栅栏:CyclicBarrier","children":[{"type":"heading","depth":4,"payload":{"lines":[150,151]},"content":"常用API","children":[{"type":"heading","depth":5,"payload":{"lines":[151,152]},"content":"await()"}]}]},{"type":"heading","depth":3,"payload":{"lines":[153,154]},"content":"线程阻塞工具类LockSupport","children":[{"type":"heading","depth":4,"payload":{"lines":[157,158]},"content":"常用API","children":[{"type":"heading","depth":5,"payload":{"lines":[158,159]},"content":"park()"},{"type":"heading","depth":5,"payload":{"lines":[160,161]},"content":"parkNanos()"},{"type":"heading","depth":5,"payload":{"lines":[161,162]},"content":"parkUntil()"}]}]}]}]},{"type":"heading","depth":1,"payload":{"lines":[164,165]},"content":"第四章 关于锁和锁的优化","children":[{"type":"heading","depth":2,"payload":{"lines":[167,168]},"content":"提升锁性能的建议","children":[{"type":"heading","depth":3,"payload":{"lines":[168,169]},"content":"减少锁的持有时间","children":[{"type":"fence","depth":4,"content":"<pre class=\"language-java\"><code class=\"language-java\"><span class=\"token keyword\">public</span> <span class=\"token class-name\">Matcher</span> <span class=\"token function\">matcher</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">CharSequence</span> input<span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>complied<span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n        <span class=\"token function\">synchornized</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>complied<span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span> <span class=\"token comment\">//个人猜测为了一种可能为了线程安全，还有一种可能为了代码的健壮性</span>\n                <span class=\"token function\">complied</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token class-name\">Mathcer</span> m<span class=\"token operator\">=</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">Matcher</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">,</span>input<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">return</span> m<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n</code></pre>\n"}]},{"type":"heading","depth":3,"payload":{"lines":[184,185]},"content":"减少锁的粒度","children":[{"type":"fence","depth":4,"content":"<pre class=\"language-java\"><code class=\"language-java\"> <span class=\"token keyword\">public</span> <span class=\"token class-name\">V</span> <span class=\"token function\">put</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">K</span> key<span class=\"token punctuation\">,</span><span class=\"token class-name\">V</span> value<span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n    <span class=\"token class-name\">Segment</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">K</span><span class=\"token punctuation\">,</span><span class=\"token class-name\">V</span><span class=\"token punctuation\">></span></span> s<span class=\"token punctuation\">;</span>\n    <span class=\"token comment\">//先处理空指针</span>\n    <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>value<span class=\"token operator\">==</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">NullPointExeception</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token comment\">//对key进行hash处理</span>\n    <span class=\"token keyword\">int</span> hash<span class=\"token operator\">=</span><span class=\"token function\">hsah</span><span class=\"token punctuation\">(</span>key<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token comment\">//获得对应的段的序号</span>\n    <span class=\"token keyword\">int</span> j<span class=\"token operator\">=</span><span class=\"token punctuation\">(</span>hash<span class=\"token operator\">>>></span>segmentShift<span class=\"token punctuation\">)</span><span class=\"token operator\">&amp;</span>segmentMask<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>s<span class=\"token operator\">=</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Segment</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">K</span><span class=\"token punctuation\">,</span><span class=\"token class-name\">V</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">)</span>UNSAFE<span class=\"token punctuation\">.</span><span class=\"token function\">getObject</span><span class=\"token punctuation\">(</span>segments<span class=\"token punctuation\">,</span><span class=\"token punctuation\">(</span>j<span class=\"token operator\">&lt;&lt;</span>SSHIFT<span class=\"token punctuation\">)</span><span class=\"token operator\">+</span>SBASE<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token operator\">==</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n        <span class=\"token comment\">//上面的if进行了一次非可变性的检验，确保在确认的段里(过于拗口)</span>\n        s<span class=\"token operator\">=</span><span class=\"token function\">ensureSegment</span><span class=\"token punctuation\">(</span>j<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token keyword\">return</span> s<span class=\"token punctuation\">.</span><span class=\"token function\">put</span><span class=\"token punctuation\">(</span>key<span class=\"token punctuation\">,</span>hash<span class=\"token punctuation\">,</span>value<span class=\"token punctuation\">,</span><span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n <span class=\"token punctuation\">}</span>\n</code></pre>\n"}]},{"type":"heading","depth":3,"payload":{"lines":[211,212]},"content":"读写分离锁来替换独占锁"},{"type":"heading","depth":3,"payload":{"lines":[213,214]},"content":"锁分离","children":[{"type":"fence","depth":4,"content":"<pre class=\"language-java\"><code class=\"language-java\"><span class=\"token keyword\">private</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">ReentrantLock</span> takeLock<span class=\"token operator\">=</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">ReentrantLock</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">//被take,poll操作线程持有的锁</span>\n\n<span class=\"token keyword\">private</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">Conditional</span> notEmpty<span class=\"token operator\">=</span>takeLock<span class=\"token punctuation\">.</span><span class=\"token function\">newCondition</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">private</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">ReentrantLock</span> putLock<span class=\"token operator\">=</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">ReentrantLock</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">//被put,offer操作线程持有的锁。</span>\n\n<span class=\"token keyword\">private</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">Conditional</span> notFull<span class=\"token operator\">=</span>putLock<span class=\"token punctuation\">.</span><span class=\"token function\">newCondition</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n</code></pre>\n"},{"type":"fence","depth":4,"content":"<pre class=\"language-java\"><code class=\"language-java\">\n</code></pre>\n"}]}]}]}],"payload":{}},{})</script>
</body>
</html>
